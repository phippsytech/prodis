<script>

    import Container from '@shared/Container.svelte';
    import Button from '@shared/PhippsyTech/svelte-ui/Button.svelte';;
    import {jspa} from "@shared/jspa.js"

    import ListDrives from './ListDrives.svelte';
    import ListFolders from './ListFolders.svelte';
    import { BreadcrumbStore } from '@shared/stores.js';
    
    BreadcrumbStore.set({
        path: [
            {url: "/settings", name: 'Settings'},
            {url: null, name: 'Documents'}
        ]
    });
    

    let googleConnected = false;
    let token = localStorage.getItem("JWT");

    let google_drive={}

    

    jspa("/Google", "checkConnected", {}, token).then((result)=>{
        googleConnected = result.result;
    })

    function connectGoogle(){
        jspa("/Google", "connect", {}, token).then((result)=>{
            document.location=result.result;
        })
    }

    jspa("/Google/SharedDrive", "getSettings", {}, token).then((result)=>{
        google_drive.shared_drive = result.result.shared_drive;
        google_drive.participants_folder = result.result.participants_folder;
        google_drive.staff_folder = result.result.staff_folder;
    })


    function save(){
        jspa("/Google/SharedDrive", "setSettings", {settings:google_drive}, token).then((result)=>{
        
    })
    }

    
</script>

<div class="text-2xl sm:truncate sm:text-3xl sm:tracking-tight font-fredoka-one-regular mb-2 " style="color:#220055;">Google Drive</div>
       
    {#if !googleConnected}
        <div class="my-4 ">
            <Button on:click={()=>connectGoogle()} label="Connect to Google Drive" />
        </div>
    {:else}
        <Container>
            Select Shared Drive
            <ListDrives bind:drive_id={google_drive.shared_drive}/>
        </Container>

        {#if google_drive.shared_drive !="Select Shared Drive"}
            <Container>
                Select Participants Folder
                <ListFolders bind:drive_id={google_drive.shared_drive} bind:folder_id={google_drive.participants_folder}/>
            </Container>

            <Container>
                Select Staff Folder
                <ListFolders bind:drive_id={google_drive.shared_drive} bind:folder_id={google_drive.staff_folder}/>
            </Container>
asdfds
            <button on:click={()=>save()} type="button" class="block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Save</button>

        {/if}
    {/if}


    